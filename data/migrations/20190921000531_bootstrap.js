
exports.up = function(knex) {
    return knex.schema.createTable('users', table => {
        table.increments()
        table.string('username')
            .unique()
            .notNull()
        table.string('email')
            .unique()
            .notNull()
        table.string('password')
            .notNull()
        table.datetime('created_at')
            .defaultTo(knex.fn.now())
    })
    .createTable('lists', table => {
        table.increments()
      table.string('name')
        .notNull()
      table.string('description')
        .notNull()
      table.integer('owner_id')
        .references('id')
        .inTable('users')
        .notNull()
        .onDelete('RESTRICT')
        .onUpdate('CASCADE')
      table.datetime('created_at')
        .defaultTo(knex.fn.now())
    })
    .createTable('invites', table => {
        table.primary(['list_id', 'invitee_id']);
        table.integer('list_id')
            .references('id')
            .inTable('lists')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.integer('invitee_id')
            .references('id')
            .inTable('users')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.boolean('rejected')
            .defaultTo(false)
        table.datetime('created_at')
            .defaultTo(knex.fn.now())
    })
    .createTable('items', table => {
        table.increments()
        table.integer('list_id')
            .references('id')
            .inTable('lists')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.string('description')
            .notNull()
        table.string('title')
            .notNull()
        table.string('picture')
            .notNull()
        table.datetime('created_at')
            .defaultTo(knex.fn.now())
    })
    .createTable('want_its', table => {
        table.increments()
        table.integer('item_id')
            .references('id')
            .inTable('items')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.integer('user_id')
            .references('id')
            .inTable('users')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.datetime('created_at')
            .defaultTo(knex.fn.now())
    })
    .createTable('item_comments', table => {
        table.increments()
        table.integer('user_id')
            .references('id')
            .inTable('users')
            .notNull()
            .onDelete('RESTRICT')
            .onUpdate('CASCADE')
        table.string('content')
            .notNull()
        table.datetime('created_at')
            .defaultTo(knex.fn.now())
    })
};

exports.down = function (knex) {
    return knex.schema.dropTableIfExists('item_comments')
        .dropTableIfExists('want_its')
        .dropTableIfExists('items')
        .dropTableIfExists('lists')
        .dropTableIfExists('users')
};